
{% load static %}
{% load custom_filter %}
{% load cart %}
<head>
<!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
      <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
       <link rel="shortcut icon" type="x-icon" href="https://i.ibb.co/Y34f0yV/icontaskbar.png">
            <link
      rel="stylesheet"
      type="text/css"
      href="{% static '/css/orders.css' %}"
    />
     <title>Orders - Dope Futsal</title>
     <script src="https://khalti.s3.ap-south-1.amazonaws.com/KPG/dist/2020.12.17.0.0.0/khalti-checkout.iffe.js"></script>
  </head>
 
  <body>

   <!-- Navigation Bar-->
   
    <nav class="navbar navbar-expand-lg navbar-light">
      <!-- Container wrapper -->
      <div class="container-fluid">
        <!-- Toggle button -->
        <button
          class="navbar-toggler"
          type="button"
          data-mdb-toggle="collapse"
          data-mdb-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <i class="fas fa-bars"></i>
        </button>
        <!-- Collapsible wrapper -->
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <!-- Navbar brand -->
          <a href="http://127.0.0.1:8000/" class="navbar-brand mt-2 mt-lg-0">
            <img
              src="https://i.ibb.co/RQn5crx/imgonline-com-ua-Replace-Color-x8-HOGnfek8b-M2-KAk-removebg-preview.png" 
              style="position: relative; left: 30%;"
              height="150"
              width="145"
              alt="Futsal Logo"
            />
          </a>
          <!-- Left links -->
          <ul class="navbar-nav mx-auto me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a href="http://127.0.0.1:8000/" class="nav-link" style="font-family: 'Anton', sans-serif; font-size: 40px; color: black; font-weight: 600;">DOPE FUTSAL</a>
            </li>
          </ul>

          <div class="fbinstaicon">
            <div class="fbinstabutton">
               <div class="icon">
                  <i class="fab fa-facebook-f"></i>
               </div>
               <a href="https://www.facebook.com/Brihaspati-Futsal-105102722128654" style="text-decoration: none;"><span>Facebook</span></a>
            </div>
            <div class="fbinstabutton">
               <div class="icon">
                  <i class="fab fa-instagram"></i>
               </div>
               <a href="https://www.instagram.com/brihaspati.futsal/" style="text-decoration: none;"><span>Instagram</span></a>
            </div>
         </div>                   
    </nav>
    <style>
      .fbinstaicon {
  margin-right: 20px;
}
.fbinstaicon .fbinstabutton {
  display: inline-block;
  height: 60px;
  width: 60px;
  margin: 0 5px;
  overflow: hidden;
  background: #fff;
  border-radius: 50px;
  cursor: pointer;
  box-shadow: 0px 10px 10px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease-out;
}
.fbinstaicon .fbinstabutton:hover {
  width: 175px;
}
.fbinstaicon .fbinstabutton .icon {
  display: inline-block;
  height: 60px;
  width: 60px;
  text-align: center;
  border-radius: 50px;
  box-sizing: border-box;
  line-height: 60px;
  transition: all 0.3s ease-out;
}
.fbinstaicon .fbinstabutton:nth-child(1):hover .icon {
  background: #4267b2;
}
.fbinstaicon .fbinstabutton:nth-child(2):hover .icon {
  background: #e1306c;
}
.fbinstaicon .fbinstabutton .icon i {
  font-size: 25px;
  line-height: 60px;
  transition: all 0.3s ease-out;
}
.fbinstaicon .fbinstabutton:hover .icon i {
  color: #fff;
}
.fbinstaicon .button span {
  font-size: 20px;
  font-weight: 500;
  line-height: 60px;
  margin-left: 10px;
  transition: all 0.3s ease-out;
}
.fbinstaicon .fbinstabutton:nth-child(1) span {
  color: #4267b2;
}
.fbinstaicon .fbinstabutton:nth-child(2) span {
  color: #e1306c;
}
    </style>

<div class="small-container cart-page">
    <p class="display-4 pl-4 ml-4" style="font-family: 'Poppins' , sans-serif; text-align: center;">Your Orders</p>
   
      <table>
        <tr>
          <th>&nbsp;&nbsp;Sno.</th>
          <th>Image</th>
          <th>Product</th>
          <th>Date</th>
          <th>Price</th>
          <th>Quantity</th>
          <th>&nbsp;Total</th>
          <th>Status&nbsp;&nbsp;</th>
        </tr>
        <tr>
          <tbody>
        {% for order in orders %}
        <tr>
          <td>&nbsp;&nbsp;{{forloop.counter}}</td>
          <td>
            <img
              style="height: 70px"
              src="{{order.product.image.url}}"
              alt=""
            />
          </td>
          <td>{{order.product.name}}</td>
          <td>{{order.date}}</td>
          <td>{{order.product.price|currency}}</td>
          <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{order.quantity}}</td>
          <td>{{order.quantity|multiply:order.price|currency}}</td>
          {% if order.status %}
          <td style="color: rgb(0, 119, 54)">Completed</td>
          {%else%}
          <td style="color: rgb(221, 14, 14)">Pending</td>
          {% endif %}
          <!-- {% if order.status %}
          <td><small class="badge badge-success">Completed</small></td>
          {%else%}
          <td><small class="badge badge-warning">Pending</small></td>
          {% endif %} -->
        </tr>

        {% endfor %}
        
      </tbody>
      
    </table>
   <div class="row"><a href="http://127.0.0.1:8000/shopping">
    <input
      type="button"
      style="margin-left: 820px;"
      class="btn float-right col-lg-2.2"
      value="Back To Shopping"
  /></a>
  <a href="http://127.0.0.1:8000/orders_pdf">
    <input
      type="button"
      style="margin-left: 835px;"
      class="btn float-right col-lg-2.2"
      value="Download PDF"
  /></a>
  </div><button id="payment-button" style="margin-left: 840px;" class="btn btn-outline-success">Pay with Khalti</button>
    
            <script>
               function verifyPayment(payload) {
        $.ajax({
            url: "{% url 'verify_payment' %}",
            type: "POST",
            data: payload,
            dataType: 'json',
            success: function (response) { alert(response) },
            error: function (error) { alert(error.responseJSON['message']) }
        });
    }

    var config = {
            // replace the publicKey with yours
            "publicKey": "test_public_key_a877f02f77be49419708f54777fcefb4",
            "productIdentity": "order_{{order.id}}",
            "productName": "order_{{order.id}}",
            "productUrl": "http://localhost:8000",
            "paymentPreference": [
                "KHALTI",
                ],
            "eventHandler": {
                onSuccess (payload) {
                    // hit merchant api for initiating verfication
                    axios.get("/khalti-verify/", {
                        params: {
                            "token": payload.token,
                            "amount": payload.amount,
                            "order_id": "{{order.id}}"
                        }
                    }).then(function(resp){
                        if (resp.data.success == true){
                            alert("Thanks. Payment Completed Successfully")
                            location.href = "/"
                        }else{
                            alert("Sorry. Error occurred")
                            location.href = "{{request.build_absolute_uri}}"
                        }
                    })
                },
                onError (error) {
                    console.log(error);
                },
                onClose () {
                    console.log('widget is closing');
                }
            }
        };

        var checkout = new KhaltiCheckout(config);
        var btn = document.getElementById("payment-button");
        btn.onclick = function () {
            // minimum transaction amount must be 10, i.e 1000 in paisa.
            checkout.show({amount: 1000});
        }
          </script> 
  </div>
</div>

